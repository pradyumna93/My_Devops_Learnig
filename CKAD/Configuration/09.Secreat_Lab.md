## ğŸ§© **Kubernetes Secrets â€“ Full Lab Summary**

### ğŸ§  **Concept Recap**

Kubernetes **Secrets** are used to securely store sensitive data like passwords, tokens, and keys.
They can be mounted as **environment variables** or **files** into Pods.

---

### ğŸ”¹ **1. Check existing secrets**

```bash
kubectl get secrets
```

âœ… Output shows default secrets (e.g., `default-token-xxxxx`).

**Q:** How many secrets exist in the default namespace?
**A:** 1

---

### ğŸ”¹ **2. Describe the secret**

```bash
kubectl describe secret default-token-xxxxx
```

**Data keys found:**

* `ca.crt`
* `namespace`
* `token`

**Q:** How many data items are defined in the secret?
**A:** 3
**Q:** What is the type of the default secret?
**A:** `kubernetes.io/service-account-token`

**Q:** Which of the following is *not* part of the secret data?
ğŸ‘‰ `type` (itâ€™s metadata, not secret data)

---

### ğŸ”¹ **3. Application architecture**

There are two Pods:

* **MySQL Pod** â†’ backend
* **WebApp Pod** â†’ frontend

And two services:

* `mysql-service` â†’ exposes MySQL
* `webapp-service` â†’ exposes frontend

Error in webapp logs:

```
Failed to connect to MySQL database: Host, DB, Password not set
```

---

### ğŸ”¹ **4. Create a new secret**

```bash
kubectl create secret generic db-secret \
  --from-literal=DB_Host=sql01 \
  --from-literal=DB_User=root \
  --from-literal=DB_Password=pass123
```

âœ… Verify:

```bash
kubectl describe secret db-secret
```

**Output:**
Data:

* DB_Host
* DB_User
* DB_Password

---

### ğŸ”¹ **5. Configure Pod to use secret**

Edit the Pod definition file (e.g., `webapp-pod.yaml`):

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: webapp-pod
spec:
  containers:
    - name: webapp
      image: kodekloud/webapp-color
      envFrom:
        - secretRef:
            name: db-secret
```

Apply:

```bash
kubectl replace -f webapp-pod.yaml --force
```

âœ… Once the Pod restarts, it loads DB credentials as environment variables.

---

### ğŸ”¹ **6. Verify**

```bash
kubectl exec -it webapp-pod -- env | grep DB
```

Output:

```
DB_Host=sql01
DB_User=root
DB_Password=pass123
```

âœ… Webapp now connects successfully to MySQL.

---

## ğŸ’¬ **Extra Questions & Answers**

| **Question**                           | **Answer**                                                      |                  |
| -------------------------------------- | --------------------------------------------------------------- | ---------------- |
| What command creates a generic secret? | `kubectl create secret generic <name> --from-literal=key=value` |                  |
| How to create a secret from a file?    | `kubectl create secret generic <name> --from-file=<filename>`   |                  |
| How to view secrets in plain text?     | `kubectl get secret <name> -o yaml` (base64 decode the values)  |                  |
| How to decode a secret?                | `echo '<encoded>'                                               | base64 --decode` |
| Where are secrets stored?              | In etcd on the Kubernetes control plane                         |                  |
| Are secrets encrypted by default?      | âŒ No. You must enable encryption at rest                        |                  |
| Can secrets be mounted as files?       | âœ… Yes, via `volumeMounts` and `volumes.secret.secretName`       |                  |
| What is a Docker registry secret type? | `kubernetes.io/dockerconfigjson`                                |                  |

---

## ğŸ§  **Advanced Lab Extensions**

1. **Mount Secret as a File:**

```yaml
volumes:
- name: secret-vol
  secret:
    secretName: db-secret

volumeMounts:
- name: secret-vol
  mountPath: /etc/db-credentials
```

Then inside container:

```
cat /etc/db-credentials/DB_Password
```

---

2. **Encode manually before applying YAML:**

```bash
echo -n 'root' | base64
```

Use that in YAML:

```yaml
data:
  DB_User: cm9vdA==
```

---

3. **Use Secret in Deployment:**

```bash
kubectl create deployment webapp --image=kodekloud/webapp-color
kubectl set env deployment/webapp --from=secret/db-secret
```

---

4. **Check Secret Usage in Pod:**

```bash
kubectl get pods --selector=app=webapp -o jsonpath='{.items[*].spec.containers[*].envFrom[*].secretRef.name}'
```

---

5. **Cleanup:**

```bash
kubectl delete secret db-secret
kubectl delete pod webapp-pod
```

---

## ğŸ’¡ **Pro Tip for Interviews**

âœ… Kubernetes stores secrets **base64-encoded, not encrypted**.
âœ… Use `EncryptionConfiguration` + `KMS` to encrypt at rest.
âœ… Avoid printing secrets in Pod logs.
âœ… Use **external secret stores** like:

* HashiCorp Vault
* Azure Key Vault
* AWS Secrets Manager
* Google Secret Manager

---


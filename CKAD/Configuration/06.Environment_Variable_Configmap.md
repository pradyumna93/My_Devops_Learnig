# ‚ò∏Ô∏è Lecture: Setting Environment Variables and Using ConfigMaps in Kubernetes

---

## üéØ Lecture Objective

In this lecture, we will learn how to:

* Define **environment variables** in a Kubernetes Pod.
* Understand the difference between **direct key-value variables** and **ConfigMaps**.
* Create and inject ConfigMaps into Pods using both **imperative** and **declarative** methods.

---

## üß† 1. Setting Environment Variables in Kubernetes

In the previous lecture, we worked with a Docker image called **ubuntu-sleeper** and ran it as a Pod.
In this lecture, we‚Äôll extend that concept by learning how to **set environment variables** for containers running inside Pods.

---

### üß© Defining Environment Variables in a Pod Definition

To set environment variables, use the **`env`** property under the container specification.

The `env` field is an **array**, and each item starts with a **dash (-)** representing one environment variable.
Each item must have a **name** and a **value** property.

Here‚Äôs an example Pod definition that sets an environment variable:

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: env-demo-pod
spec:
  containers:
  - name: ubuntu-sleeper
    image: ubuntu-sleeper
    env:
    - name: APP_COLOR
      value: "blue"
    - name: APP_MODE
      value: "production"
```

‚úÖ **Explanation:**

* `name`: The name of the environment variable available inside the container.
* `value`: The actual value assigned to that variable.

Inside the running container, you can check the environment variable:

```bash
echo $APP_COLOR
# Output: blue
```

---

### üß© Using ConfigMaps or Secrets for Environment Variables

Specifying environment variables directly in every Pod can quickly become difficult to manage ‚Äî especially when you have many Pods.

To make this more manageable and centralized, Kubernetes provides **ConfigMaps** and **Secrets**.

Instead of defining a value directly, you use the **`valueFrom`** field to reference a **ConfigMap** or **Secret**.

Example:

```yaml
env:
- name: APP_COLOR
  valueFrom:
    configMapKeyRef:
      name: app-config
      key: APP_COLOR
```

> üìù We‚Äôll discuss ConfigMaps and Secrets in more detail next.

---

## üß± 2. Working with Configuration Data Using ConfigMaps

---

### üß© What is a ConfigMap?

A **ConfigMap** is a Kubernetes object used to **store configuration data** in key-value pairs.
Pods can then use this data as **environment variables** or **mounted files**.

This approach helps you:

* Decouple configuration from your Pod definitions.
* Manage environment data centrally.
* Reuse the same configuration across multiple Pods.

---

### üß© Step 1: Create a ConfigMap

There are two main ways to create ConfigMaps:

#### **A. Imperative Method (Using kubectl Command)**

You can create a ConfigMap directly from the command line.

**Syntax:**

```bash
kubectl create configmap <configmap-name> --from-literal=<key>=<value>
```

**Example:**

```bash
kubectl create configmap app-config --from-literal=APP_COLOR=blue
```

You can add multiple key-value pairs:

```bash
kubectl create configmap app-config \
  --from-literal=APP_COLOR=blue \
  --from-literal=APP_MODE=production
```

‚úÖ **Tip:**
For many key-value pairs, this approach becomes cluttered ‚Äî use a file instead.

---

#### **B. From a File**

If you have a file (say `app.properties`) containing configuration data:

```
APP_COLOR=blue
APP_MODE=production
```

You can create a ConfigMap from it using:

```bash
kubectl create configmap app-config --from-file=app.properties
```

Kubernetes will store the contents of the file under the file‚Äôs name.

---

#### **C. Declarative Method (Using YAML File)**

You can also define a ConfigMap declaratively, similar to other Kubernetes objects.

**Example: `app-config.yaml`**

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: app-config
data:
  APP_COLOR: "blue"
  APP_MODE: "production"
```

Apply it using:

```bash
kubectl apply -f app-config.yaml
```

---

### üß© Step 2: Inject ConfigMap into a Pod

Once the ConfigMap is created, you can inject it into a Pod using the **`envFrom`** or **`env`** fields.

#### **Option 1: Use `envFrom` to Inject All Keys**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
spec:
  containers:
  - name: simple-webapp
    image: simple-webapp
    envFrom:
    - configMapRef:
        name: app-config
```

‚úÖ This automatically makes all key-value pairs in `app-config` available as environment variables inside the container.

#### **Option 2: Use `env` to Inject Specific Keys**

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: app-pod
spec:
  containers:
  - name: simple-webapp
    image: simple-webapp
    env:
    - name: APP_COLOR
      valueFrom:
        configMapKeyRef:
          name: app-config
          key: APP_COLOR
```

---

### üß© Step 3: Verify

List ConfigMaps:

```bash
kubectl get configmaps
```

Describe the ConfigMap:

```bash
kubectl describe configmap app-config
```

View environment variables inside the container:

```bash
kubectl exec -it app-pod -- env
```

You should see:

```
APP_COLOR=blue
APP_MODE=production
```

---

## üì¶ Other Ways to Use ConfigMaps

Besides environment variables, ConfigMaps can also be:

* **Mounted as files** inside containers.
* Used by multiple Pods or Deployments.
* Combined with **Secrets** for secure configuration management.

---

## üß† Summary

| Concept           | Description                                            |
| ----------------- | ------------------------------------------------------ |
| **env**           | Defines environment variables directly in the Pod spec |
| **ConfigMap**     | Stores configuration data in key-value format          |
| **envFrom**       | Injects all key-value pairs from a ConfigMap           |
| **env/valueFrom** | Injects a specific key from a ConfigMap                |
| **Secrets**       | Similar to ConfigMaps but used for sensitive data      |

---

## üí¨ Practice Tasks

1. Create a ConfigMap named `db-config` with:

   * `DB_HOST=mysql`
   * `DB_PORT=3306`

2. Create a Pod named `db-client` using the image `mysql:5.7` and inject `db-config` into it.

3. Verify environment variables using:

   ```bash
   kubectl exec -it db-client -- env
   ```

4. Try modifying the ConfigMap and reloading it in your Pod.

---

## üß† Interview / Exam Q&A

| Question                                             | Answer                                                                                 |
| ---------------------------------------------------- | -------------------------------------------------------------------------------------- |
| What is the purpose of a ConfigMap?                  | To store and manage non-confidential configuration data as key-value pairs.            |
| How do you inject environment variables into a Pod?  | Using `env` or `envFrom` in the Pod spec.                                              |
| What is the difference between ConfigMap and Secret? | Secrets store sensitive data (encoded), while ConfigMaps store plain-text config data. |
| How do you create a ConfigMap from a file?           | `kubectl create configmap <name> --from-file=<path>`                                   |
| How do you view ConfigMaps in a namespace?           | `kubectl get configmaps`                                                               |
| Can multiple Pods use the same ConfigMap?            | Yes, ConfigMaps are reusable across multiple Pods.                                     |

---

## üöÄ Suggested Hands-On Labs

1. Create a ConfigMap for a **React** or **Node.js** app containing `APP_ENV`, `API_URL`, and `THEME_COLOR`.
2. Mount the ConfigMap as a **volume** inside the container.
3. Modify and reload the ConfigMap without restarting the Pod.
4. Explore using **Secrets** for credentials like database passwords.

---

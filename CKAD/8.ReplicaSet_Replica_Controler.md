# ðŸ§© **Kubernetes Controllers â€“ Replication Controller & ReplicaSet**

---

## ðŸ§  **What Are Controllers?**

* Controllers are the **brain of Kubernetes**.
* They are background processes that **monitor Kubernetes objects** (like Pods, Deployments, etc.) and **take corrective actions** automatically.
* Their main job is to **maintain the desired state** of the cluster.

---

## âš™ï¸ **Replication Controller Overview**

### ðŸ§© What Is a Replica?

A **replica** is simply **a copy of a Pod** â€” running the same application.

### ðŸ“Œ Why Do We Need a Replication Controller?

Letâ€™s revisit an example:

* Suppose we have a single Pod running an application.
* If that Pod fails or crashes, **the application becomes unavailable**.
* To prevent downtime, we run **multiple Pods (replicas)** of the same application.

âœ… The **Replication Controller (RC)** ensures that the desired number of Pods are **always running** â€” whether thatâ€™s **1 or 100**.

---

## ðŸ’ª **Key Benefits of a Replication Controller**

1. **High Availability:**
   Ensures the required number of Pods are always up and running.

2. **Load Balancing:**
   Distributes incoming traffic across multiple Pods.

3. **Self-Healing:**
   Automatically replaces failed Pods.

4. **Scalability:**
   Easily scale applications up or down by changing the replica count.

---

## ðŸ§© **Replication Controller vs. ReplicaSet**

| Feature         | Replication Controller | ReplicaSet                            |
| --------------- | ---------------------- | ------------------------------------- |
| Status          | Older technology       | New and recommended                   |
| API Version     | `v1`                   | `apps/v1`                             |
| Selector        | Optional               | **Mandatory**                         |
| Matching Labels | Basic                  | Advanced (matchExpressions supported) |

> ðŸ’¡ **Note:** The concepts are the same, but **ReplicaSet** is the **modern replacement** for Replication Controller.

---

## ðŸ§± **Creating a Replication Controller**

A Kubernetes definition file always has four sections:

```
apiVersion, kind, metadata, spec
```

### ðŸ§¾ Example: replication-controller.yaml

```yaml
apiVersion: v1
kind: ReplicationController
metadata:
  name: myapp-rc
  labels:
    app: myapp
    type: frontend
spec:
  replicas: 3
  template:
    metadata:
      name: myapp-pod
      labels:
        app: myapp
        type: frontend
    spec:
      containers:
        - name: nginx-container
          image: nginx
```

---

### ðŸ“˜ **Explanation:**

* **replicas:** Number of Pods you want running.
* **template:** Describes the Pod structure (just like a Pod YAML).
* **metadata:** Labeling helps identify Pods created by this RC.

---

### âš¡ **Commands**

| Task                    | Command                                         |
| ----------------------- | ----------------------------------------------- |
| Create RC               | `kubectl create -f replication-controller.yaml` |
| View RCs                | `kubectl get replicationcontroller`             |
| View Pods created by RC | `kubectl get pods`                              |
| Delete RC               | `kubectl delete replicationcontroller myapp-rc` |

> The Pods created by the RC will have names prefixed with **myapp-rc**.

---

## ðŸ§© **ReplicaSet (The Modern Replacement)**

### ðŸ§¾ Example: replicaset.yaml

```yaml
apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: myapp-rs
  labels:
    app: myapp
    type: frontend
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
        type: frontend
    spec:
      containers:
        - name: nginx-container
          image: nginx
```

---

### ðŸ“˜ **Explanation:**

* **apiVersion:** `apps/v1` (different from ReplicationController)
* **selector:** Required field â€” defines which Pods belong to this ReplicaSet.
* **template:** Describes how to create new Pods if needed.
* **replicas:** Number of desired Pods.

---

## ðŸ§© **Labels and Selectors**

* **Labels** are keyâ€“value pairs attached to objects (Pods, ReplicaSets, etc.).
* **Selectors** identify objects by matching those labels.

Example:

```yaml
selector:
  matchLabels:
    app: myapp
```

> ðŸ§  **Why labels matter:**
> The ReplicaSet uses these labels to identify which Pods it should monitor.
> It ensures the correct Pods are managed â€” even if some were created manually before the ReplicaSet was deployed.

---

## ðŸ” **Scenario Example**

Suppose:

* You already have **three Pods** with the label `app: myapp`.
* You create a ReplicaSet with the same selector (`app: myapp`).

âž¡ï¸ The ReplicaSet will **adopt** those existing Pods instead of creating new ones.
However, you **must still provide a template section**, because:

* If any Pod fails later, the ReplicaSet needs the **template** to recreate it.

---

## âš™ï¸ **Scaling ReplicaSets**

### ðŸ§© Option 1: Update the YAML File

1. Modify `replicas: 3` to `replicas: 6`
2. Reapply the file:

   ```bash
   kubectl apply -f replicaset.yaml
   ```

### ðŸ§© Option 2: Use the Scale Command

```bash
kubectl scale --replicas=6 -f replicaset.yaml
```

or

```bash
kubectl scale replicaset myapp-rs --replicas=6
```

> âš ï¸ Note: Scaling with the `scale` command does **not** update the replica count inside your YAML file â€” only in the running configuration.

---

## ðŸ§© **Key Commands Recap**

| Task                        | Command                                          |
| --------------------------- | ------------------------------------------------ |
| Create ReplicaSet           | `kubectl create -f replicaset.yaml`              |
| View ReplicaSets            | `kubectl get replicaset`                         |
| View Pods                   | `kubectl get pods`                               |
| Delete ReplicaSet           | `kubectl delete replicaset myapp-rs`             |
| Replace (update) ReplicaSet | `kubectl replace -f replicaset.yaml`             |
| Scale ReplicaSet            | `kubectl scale --replicas=6 replicaset myapp-rs` |

---

## âš™ï¸ **Advanced: Auto Scaling**

* Kubernetes can automatically scale ReplicaSets based on **CPU or memory usage** using the **Horizontal Pod Autoscaler (HPA)**.
* Example:

  ```bash
  kubectl autoscale rs myapp-rs --min=3 --max=10 --cpu-percent=80
  ```

> Weâ€™ll cover this in the **auto-scaling lecture**.

---

## ðŸ§¾ **Summary**

| Concept                         | Description                                         |
| ------------------------------- | --------------------------------------------------- |
| **Controller**                  | The process that ensures the desired cluster state  |
| **Replication Controller (RC)** | Older mechanism to maintain desired Pods            |
| **ReplicaSet (RS)**             | Newer and improved version with advanced selectors  |
| **Labels**                      | Keyâ€“value pairs used to identify Pods               |
| **Selectors**                   | Used by ReplicaSets to monitor/manage specific Pods |
| **Scaling**                     | Adjust number of Pods manually or automatically     |

---

âœ… **In short:**

> The **Replication Controller** and **ReplicaSet** are Kubernetes components that ensure your application always runs the right number of Pods â€” maintaining **high availability, scalability, and reliability**.

---

